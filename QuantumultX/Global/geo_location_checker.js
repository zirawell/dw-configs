if ($response.statusCode !== 200) {
  $done(null);
}

let city0 = "é«˜è°­å¸‚";
let isp0 = "Cross-GFW.org";

function City_ValidCheck(para) {
  if (para) {
      if (para.length < 6) {
          return para
      } else {
          return para.slice(0, 5)
      }

  } else {
      return city0
  }
}

function ISP_ValidCheck(para) {
  if (para) {
      return para
  } else {
      return isp0
  }
}

function Area_check(para) {
  if (para === "ä¸­åŽæ°‘å›½") {
      return "å°æ¹¾"
  } else {
      return para
  }
}

function Duplication_check() {
  if (obj['country'] === City_ValidCheck(obj['province'])) {
      return obj['country'];
  } else {
      return `${obj['country']} ${City_ValidCheck(obj['province'])}`;
  }
}

let flags = new Map([["å—éž", "ðŸ‡¦ðŸ‡«"], ["å®‰å‰æ‹‰", "ðŸ‡¦ðŸ‡®"], ["é˜¿å°”å·´å°¼äºš", "ðŸ‡¦ðŸ‡±"], ["äºšç¾Žå°¼äºš", "ðŸ‡¦ðŸ‡²"], ["å—æžæ´²", "ðŸ‡¦ðŸ‡¶"], ["é˜¿æ ¹å»·", "ðŸ‡¦ðŸ‡·"], ["ç¾Žå±žè¨å°¼äºš", "ðŸ‡¦ðŸ‡¸"], ["å¥¥åœ°åˆ©", "ðŸ‡¦ðŸ‡¹"], ["æ¾³å¤§åˆ©äºš", "ðŸ‡¦ðŸ‡º"], ["é˜¿é²å·´", "ðŸ‡¦ðŸ‡¼"], ["å¥¥å…°", "ðŸ‡¦ðŸ‡½"], ["é˜¿å¡žæ‹œç–†", "ðŸ‡¦ðŸ‡¿"], ["å·´å·´å¤šæ–¯", "ðŸ‡§ðŸ‡§"], ["å­ŸåŠ æ‹‰", "ðŸ‡§ðŸ‡©"], ["æ¯”åˆ©æ—¶", "ðŸ‡§ðŸ‡ª"], ["å¸ƒåŸºçº³æ³•ç´¢", "ðŸ‡§ðŸ‡«"], ["ä¿åŠ åˆ©äºš", "ðŸ‡§ðŸ‡¬"], ["å·´æž—", "ðŸ‡§ðŸ‡­"], ["å¸ƒéš†è¿ª", "ðŸ‡§ðŸ‡®"], ["è´å®", "ðŸ‡§ðŸ‡¯"], ["ç™¾æ…•å¤§", "ðŸ‡§ðŸ‡²"], ["æ–‡èŽ±", "ðŸ‡§ðŸ‡³"], ["çŽ»åˆ©ç»´äºš", "ðŸ‡§ðŸ‡´"], ["å·´è¥¿", "ðŸ‡§ðŸ‡·"], ["å·´å“ˆé©¬", "ðŸ‡§ðŸ‡¸"], ["ä¸ä¸¹", "ðŸ‡§ðŸ‡¹"], ["æŒªå¨", "ðŸ‡§ðŸ‡»"], ["åšèŒ¨ç“¦çº³", "ðŸ‡§ðŸ‡¼"], ["ç™½ä¿„ç½—æ–¯", "ðŸ‡§ðŸ‡¾"], ["ä¼¯åˆ©å…¹", "ðŸ‡§ðŸ‡¿"], ["åŠ æ‹¿å¤§", "ðŸ‡¨ðŸ‡¦"], ["ä¸­éžå…±å’Œå›½", "ðŸ‡¨ðŸ‡«"], ["ç‘žå£«", "ðŸ‡¨ðŸ‡­"], ["åº“å…‹ç¾¤å²›", "ðŸ‡¨ðŸ‡°"], ["æ™ºåˆ©", "ðŸ‡¨ðŸ‡±"], ["å–€éº¦éš†", "ðŸ‡¨ðŸ‡²"], ["ä¸­å›½", "ðŸ‡¨ðŸ‡³"], ["å“¥ä¼¦æ¯”äºš", "ðŸ‡¨ðŸ‡´"], ["CP", "ðŸ‡¨ðŸ‡µ"], ["å“¥æ–¯è¾¾é»ŽåŠ ", "ðŸ‡¨ðŸ‡·"], ["å¤å·´", "ðŸ‡¨ðŸ‡º"], ["ä½›å¾—è§’", "ðŸ‡¨ðŸ‡»"], ["åº“æ‹‰ç´¢", "ðŸ‡¨ðŸ‡¼"], ["åœ£è¯žå²›", "ðŸ‡¨ðŸ‡½"], ["å¡žæµ¦è·¯æ–¯", "ðŸ‡¨ðŸ‡¾"], ["æ·å…‹", "ðŸ‡¨ðŸ‡¿"], ["å¾·å›½", "ðŸ‡©ðŸ‡ª"], ["DG", "ðŸ‡©ðŸ‡¬"], ["å‰å¸ƒæ", "ðŸ‡©ðŸ‡¯"], ["ä¸¹éº¦", "ðŸ‡©ðŸ‡°"], ["å¤šç±³å°¼å…‹", "ðŸ‡©ðŸ‡²"], ["å¤šç±³å°¼åŠ ", "ðŸ‡©ðŸ‡´"], ["é˜¿å°”åŠåˆ©äºš", "ðŸ‡©ðŸ‡¿"], ["è¥¿ç­ç‰™", "ðŸ‡ªðŸ‡¦"], ["åŽ„ç“œå¤šå°”", "ðŸ‡ªðŸ‡¨"], ["çˆ±æ²™å°¼äºš", "ðŸ‡ªðŸ‡ª"], ["åŸƒåŠ", "ðŸ‡ªðŸ‡¬"], ["è¥¿æ’’å“ˆæ‹‰", "ðŸ‡ªðŸ‡­"], ["åŽ„ç«‹ç‰¹é‡Œäºš", "ðŸ‡ªðŸ‡·"], ["è¥¿ç­ç‰™", "ðŸ‡ªðŸ‡¸"], ["åŸƒå¡žä¿„æ¯”äºš", "ðŸ‡ªðŸ‡¹"], ["æ¬§ç›Ÿ", "ðŸ‡ªðŸ‡º"], ["èŠ¬å…°", "ðŸ‡«ðŸ‡®"], ["æ–æµŽ", "ðŸ‡«ðŸ‡¯"], ["ç¦å…‹å…°ç¾¤å²›", "ðŸ‡«ðŸ‡°"], ["å¯†å…‹ç½—å°¼è¥¿äºšè”é‚¦", "ðŸ‡«ðŸ‡²"], ["æ³•ç½—ç¾¤å²›", "ðŸ‡«ðŸ‡´"], ["æ³•å›½", "ðŸ‡«ðŸ‡·"], ["åŠ è“¬", "ðŸ‡¬ðŸ‡¦"], ["è‹±å›½", "ðŸ‡¬ðŸ‡§"], ["é¦™æ¸¯", "ðŸ‡­ðŸ‡°"], ["åŒˆç‰™åˆ©", "ðŸ‡­ðŸ‡º"], ["å°åº¦å°¼è¥¿äºš", "ðŸ‡®ðŸ‡©"], ["çˆ±å°”å…°", "ðŸ‡®ðŸ‡ª"], ["ä»¥è‰²åˆ—", "ðŸ‡®ðŸ‡±"], ["æ›¼å²›", "ðŸ‡®ðŸ‡²"], ["å°åº¦", "ðŸ‡®ðŸ‡³"], ["å†°å²›", "ðŸ‡®ðŸ‡¸"], ["æ„å¤§åˆ©", "ðŸ‡®ðŸ‡¹"], ["æ—¥æœ¬", "ðŸ‡¯ðŸ‡µ"], ["éŸ©å›½", "ðŸ‡°ðŸ‡·"], ["å¢æ£®å ¡", "ðŸ‡±ðŸ‡º"], ["æ¾³é—¨", "ðŸ‡²ðŸ‡´"], ["å¢¨è¥¿å“¥", "ðŸ‡²ðŸ‡½"], ["é©¬æ¥è¥¿äºš", "ðŸ‡²ðŸ‡¾"], ["è·å…°", "ðŸ‡³ðŸ‡±"], ["è²å¾‹å®¾", "ðŸ‡µðŸ‡­"], ["ç½—é©¬å°¼äºš", "ðŸ‡·ðŸ‡´"], ["å¡žå°”ç»´äºš", "ðŸ‡·ðŸ‡¸"], ["ä¿„ç½—æ–¯", "ðŸ‡·ðŸ‡º"], ["å¢æ—ºè¾¾", "ðŸ‡·ðŸ‡¼"], ["æ²™ç‰¹é˜¿æ‹‰ä¼¯", "ðŸ‡¸ðŸ‡¦"], ["æ‰€ç½—é—¨ç¾¤å²›", "ðŸ‡¸ðŸ‡§"], ["å¡žèˆŒå°”", "ðŸ‡¸ðŸ‡¨"], ["è‹ä¸¹", "ðŸ‡¸ðŸ‡©"], ["ç‘žå…¸", "ðŸ‡¸ðŸ‡ª"], ["æ–°åŠ å¡", "ðŸ‡¸ðŸ‡¬"], ["æ³°å›½", "ðŸ‡¹ðŸ‡­"], ["çªå°¼è¥¿äºš", "ðŸ‡¹ðŸ‡³"], ["æ±¤åŠ ", "ðŸ‡¹ðŸ‡´"], ["åœŸè€³å…¶", "ðŸ‡¹ðŸ‡·"], ["å›¾ç“¦å¢", "ðŸ‡¹ðŸ‡»"], ["å°æ¹¾", "ðŸ‡¨ðŸ‡³"], ["è‹±å›½", "ðŸ‡¬ðŸ‡§"], ["ç¾Žå±žç¦»å²›", "ðŸ‡ºðŸ‡²"], ["ç¾Žå›½", "ðŸ‡ºðŸ‡¸"], ["ä¹Œæ‹‰åœ­", "ðŸ‡ºðŸ‡¾"], ["ä¹Œå…¹åˆ«å…‹", "ðŸ‡ºðŸ‡¿"], ["æ¢µè’‚å†ˆ", "ðŸ‡»ðŸ‡¦"], ["å§”å†…ç‘žæ‹‰", "ðŸ‡»ðŸ‡ª"], ["è‹±å±žç»´äº¬ç¾¤å²›", "ðŸ‡»ðŸ‡¬"], ["ç¾Žå±žç»´äº¬ç¾¤å²›", "ðŸ‡»ðŸ‡®"], ["è¶Šå—", "ðŸ‡»ðŸ‡³"], ["å—éž", "ðŸ‡¿ðŸ‡¦"]])

let body = $response.body;

let obj = JSON.parse(body)["data"];

let emoji = flags.get(obj['country']) ? flags.get(obj['country']) : "ðŸ´â€â˜ ï¸"
emoji = City_ValidCheck(obj['province']) === "é¦™æ¸¯" ? "ðŸ‡­ðŸ‡°ï¸" : emoji
emoji = City_ValidCheck(obj['province']) === "æ¾³é—¨" ? "ï¸ðŸ‡²ðŸ‡´ï¸" : emoji
// emoji=City_ValidCheck(obj['province']) == "å°æ¹¾"? "ï¸ï¸ðŸ‡¹ðŸ‡¼":emoji

let title = `${emoji} | ${Duplication_check()}`;

let subtitle = `ðŸŒ | ${ISP_ValidCheck(obj['isp'])}`;

let ip = obj['addr'];

let description = `æœåŠ¡å•†: ${obj['isp']}
å®šä½: [ ${obj["latitude"]},${obj["longitude"]} ] 
IP: ${obj['addr']}
æ—¶åŒº: ${obj['timezone']}`;

$done({title, subtitle, ip, description});